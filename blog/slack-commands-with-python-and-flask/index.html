<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Creating Slack Slash Commands with Python and Flask: Part 1 | Peter Baumgartner</title>
<meta name=keywords content>
<meta name=description content="Note (2018-04-09): Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial this blog from DigitalOcean is good. Part 1: Setting Up Our Workflow and a Simple Application A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization&rsquo;s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.">
<meta name=author content>
<link rel=canonical href=https://www.peterbaumgartner.com/blog/slack-commands-with-python-and-flask/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.peterbaumgartner.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.peterbaumgartner.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.peterbaumgartner.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.peterbaumgartner.com/apple-touch-icon.png>
<link rel=mask-icon href=https://www.peterbaumgartner.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-72692144-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Creating Slack Slash Commands with Python and Flask: Part 1">
<meta property="og:description" content="Note (2018-04-09): Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial this blog from DigitalOcean is good. Part 1: Setting Up Our Workflow and a Simple Application A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization&rsquo;s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.peterbaumgartner.com/blog/slack-commands-with-python-and-flask/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2016-01-18T00:00:00+00:00">
<meta property="article:modified_time" content="2016-01-18T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Creating Slack Slash Commands with Python and Flask: Part 1">
<meta name=twitter:description content="Note (2018-04-09): Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial this blog from DigitalOcean is good. Part 1: Setting Up Our Workflow and a Simple Application A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization&rsquo;s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://www.peterbaumgartner.com/blog/"},{"@type":"ListItem","position":2,"name":"Creating Slack Slash Commands with Python and Flask: Part 1","item":"https://www.peterbaumgartner.com/blog/slack-commands-with-python-and-flask/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating Slack Slash Commands with Python and Flask: Part 1","name":"Creating Slack Slash Commands with Python and Flask: Part 1","description":"Note (2018-04-09): Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial this blog from DigitalOcean is good. Part 1: Setting Up Our Workflow and a Simple Application A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization\u0026rsquo;s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.","keywords":[],"articleBody":"Note (2018-04-09): Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial this blog from DigitalOcean is good. Part 1: Setting Up Our Workflow and a Simple Application A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization’s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.\nWith that in mind, I set out to create a Slash Command for our Slack team. The end product was a slash command command that returned real time traffic and drive time data from the Google Directions API to Slack.\nThe process was a bit arduous, especially for a relative web development newbie. There’s quite a bit to understand for all the pieces to come together, so I thought I would document a the process to help out other Slackers looking to create custom Slack commands. In addition, I’ll walk through some of the debugging and problem solving I did while creating an app. We won’t be replicating the /drive command, but be working with something more simple for the purposes of this example.\nFinal Product for the Complete Tutorial When we’re done with the complete tutorial we will have created a slash command for Slack that allows a user to get information on expected rainfall rain at a specified location. Our final command will be /rain, but we’ll be making a simple /hello command for this part of the tutorial.\nRequirements Software\n Slack Python 3.x (It will probably work on 2.x as well) Flask A text editor (I used Sublime Text 2, but am starting to love Atom) ngrok for testing our application forecast.io API Key  Skills\n Basic command line familiarity Basic python skills (package installation, basic syntax)  Other Notes: I built this on OSX, so some language or operations may be OS specific.\nSetting up a Workflow Let’s create a simple “Hello World” Flask app to understand the foundational structure of a Flask application. As we do so, we’ll walk through the steps of a workflow that will allow us to test our application from within Slack.\nCreating a Flask App Create a new folder for your application and inside of it create a new python file – hello.py will work. Insert the following code into that file:\nfrom flask import Flask import os app = Flask(__name__) @app.route('/hello', methods=['POST']) def hello(): return 'Hello Slack!' if __name__ == '__main__': port = int(os.environ.get('PORT', 5000)) app.run(host='0.0.0.0', port=port, debug=True) This is actually our entire application. Let’s take a look at one block at a time to understand the code.\nImporting Flask \u0026 Creating an Application Object from flask import Flask import os app = Flask(__name__) In this step we’re importing the required libraries. We’re importing the Flask class from the flask package, as well as the os package, which we’ll need later in our code.\nWe’re also creating an application object named app from the Flask class. Don’t worry about the __name__ parameter for the Flask object, if you’re really curious here’s some detail.\nDefining Routing and Request Methods @app.route('/hello', methods=['POST']) def hello(): return 'Hello Slack!' This is the functional meat of our application so let’s break it down. @app.route() is a function decorator – it basically modifies something about the next function we’re going to declare. The first parameter to this decorator is '/hello'. This parameter is critically important: it defines what happens when someone goes to the URL http://www.oururl.com/hello. The second parameter is methods=['POST']. This is telling us that we are only going to accept POST requests at this route.\nThe idea of requests were a bit perplexing to me at first so I’ll try and briefly explain. At the most basic level, communication on the internet mostly exists between clients and servers (there’s actually a good Simple Wikipedia article on this). For example: when you’re surfing the web, you’re actually making a GET request as a client to the server in order to view a webpage. This request tells a website or application to “give the client some information”. For this current page that information is HTML and some other files that are then interpreted by your web browser and displayed. POST requests tell a site or application that it will be receiving information at that URL. That is: instead of a website or application sending something, the application will receive something. In our case, our application is going to receive the POST request from Slack, and that request will contain some information which our application can use.\nFinally we define the hello() function, which defines what happens when someone uses our /hello route. In this case, all we’re going to do is return a string to them that says Hello Slack! if a request is made.\nDeclaring the Application Port if __name__ == '__main__': port = int(os.environ.get('PORT', 5000)) app.run(host='0.0.0.0', port=port, debug=True) This last chunk does something simple: when you run this program (and it’s the main program), find the port of 5000, and then finally serve the application locally using that port.\nTesting our Application with ngrok Our application should be ready to test. Open terminal and navigate to your project folder, and type python hello.py to start our program. Terminal should pop up some information about where the server is running and that the debugger is active. Now we have to test our application.\nThis was a step that actually stumped me for a while. Previously, I had built applications or websites that only accepted GET requests. In this case, we can test it locally by just running the python file we created and browsing to http://localhost:5000/hello and we can see our application. If we did that now with our application, we’ll get a nice Method Not Allowed page since our application only accepts post requests.\nWe could send POST requests from our computer to our application locally using curl, but that’s more work than just loading a page in a browser and, more importantly, we would have to put some effort into making sure our request was in the same format as it would come from Slack. Additionally, our request won’t be coming from our local computer to our local server, it will be coming from wherever the Slack server is to our server. Because of that, we can’t use localhost for testing with Slack, since localhost (relative to Slack, which is sending the request) is where the Slack server is, and it doesn’t have our application files.\nLuckily, there’s a fantastic application called ngrok that allows us to create a public URL to access a local server. We can use this to host our application locally, then point our Slack application to the public URL generated by ngrok. Using ngrok is fairly simple: download the file, open a shell to where you downloaded the file (or take this time to add it to your path), and type ngrok http 5000 in the shell. You should now see something like this in your terminal:\nngrok by @inconshreveable Tunnel Status online Version 2.0.19/2.0.19 Web Interface http://127.0.0.1:4040 Forwarding http://c654a618.ngrok.io - localhost:5000 Forwarding https://c654a618.ngrok.io - localhost:5000 Connections ttl opn rt1 rt5 p50 p90 0 0 0.00 0.00 0.00 0.00 If we were accepting GET requests in our app, we could now head to the URLs above and view our page. However, if we go there now, nothing will happen since we’re only accepting POST requests.\nAdding our Slash Command to Slack To add a slash command integration to your Slack channel, head to https://slack.com/apps, then navigate to Browse apps  Custom Integrations  Slash Commands and click the Add Configuration button.\nOur slash command for our example will start as /hello. Type that in and click Add Slash Command Configuration.\nAfter then, we have some options to configure on our app. The URL field is critical here. We’re going to paste the URL that ngrok gave us, being sure to append /hello at the end. That means our URL should be something similar to: http://c654a618.ngrok.io/hello. The integration settings should match below:\nTesting Now we can save our integration, head to a Slack channel (I prefer DMs with slackbot), and type /hello into the chat. We should see a response of “Hello Slack!” immediately after.\n  You should also notice the requests popping up in the ngrok Terminal window every time you issue the command.\nIn Summary Using Python, Flask, and ngrok we developed and tested a simple Flask application that responds to the /hello command in Slack.\nSome key ideas that took me a while to comprehend:\n URLs accept multiple kinds of requests: GET and POST are the most common  GET says: “give me some information” POST says: “I’m giving you information”   We can’t test complex POST requests easily using localhost. Fortunately, we can use ngrok to get a public URL for a server we’re running locally and send it POST requests from Slack  Next Time In the next part (Creating Slack Slash Commands with Python and Flask: Part 2: Electric Bugaloo), we’ll extend our app to use a weather API that returns some information about expected rainfall. We’ll also work to better understand how Slack sends requests to our app and what information is contained in a POST request.\n","wordCount":"1562","inLanguage":"en","datePublished":"2016-01-18T00:00:00Z","dateModified":"2016-01-18T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peterbaumgartner.com/blog/slack-commands-with-python-and-flask/"},"publisher":{"@type":"Organization","name":"Peter Baumgartner","logo":{"@type":"ImageObject","url":"https://www.peterbaumgartner.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.peterbaumgartner.com/ accesskey=h title="Peter Baumgartner (Alt + H)">Peter Baumgartner</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://www.peterbaumgartner.com/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://www.peterbaumgartner.com/blog/ title=Blog>
<span>Blog</span>
</a>
</li>
<li>
<a href=https://www.peterbaumgartner.com/notebooks/ title=Notebooks>
<span>Notebooks</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Creating Slack Slash Commands with Python and Flask: Part 1
</h1>
<div class=post-meta><span title="2016-01-18 00:00:00 +0000 UTC">January 18, 2016</span>
</div>
</header>
<div class=post-content><div class=note><strong>Note (2018-04-09): </strong>Slack's API has changed since I wrote this article. I also never wrote a part 2. If you want an up to date tutorial <a href=https://www.digitalocean.com/community/tutorials/how-to-write-a-slash-command-with-flask-and-python-3-on-ubuntu-16-04>this blog</a> from DigitalOcean is good.</div>
<h2 id=part-1-setting-up-our-workflow-and-a-simple-application>Part 1: Setting Up Our Workflow and a Simple Application<a hidden class=anchor aria-hidden=true href=#part-1-setting-up-our-workflow-and-a-simple-application>#</a></h2>
<p>A few weekends ago my pet project was to set up a drive time slash command in Slack. Searching through our organization&rsquo;s Slack conversation history, on top of overhearing several conversations, it seems like traffic is both a source of anguish and a favorite topic for smalltalk in our office.</p>
<p>With that in mind, I set out to create a Slash Command for our Slack team. The end product was a slash command command that returned real time traffic and drive time data from the Google Directions API to Slack.</p>
<p>The process was a bit arduous, especially for a relative web development newbie. There’s quite a bit to understand for all the pieces to come together, so I thought I would document a the process to help out other Slackers looking to create custom Slack commands. In addition, I’ll walk through some of the debugging and problem solving I did while creating an app. We won&rsquo;t be replicating the <code>/drive</code> command, but be working with something more simple for the purposes of this example.</p>
<h3 id=final-product-for-the-complete-tutorial>Final Product for the Complete Tutorial<a hidden class=anchor aria-hidden=true href=#final-product-for-the-complete-tutorial>#</a></h3>
<p>When we&rsquo;re done with the complete tutorial we will have created a slash command for Slack that allows a user to get information on expected rainfall rain at a specified location. Our final command will be <code>/rain</code>, but we&rsquo;ll be making a simple <code>/hello</code> command for this part of the tutorial.</p>
<h3 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>#</a></h3>
<p><strong>Software</strong></p>
<ul>
<li>Slack</li>
<li>Python 3.x (It will probably work on 2.x as well)</li>
<li>Flask</li>
<li>A text editor (I used Sublime Text 2, but am starting to love Atom)</li>
<li><a href=https://ngrok.com/>ngrok</a> for testing our application</li>
<li><a href=https://developer.forecast.io/>forecast.io</a> API Key</li>
</ul>
<p><strong>Skills</strong></p>
<ul>
<li>Basic command line familiarity</li>
<li>Basic python skills (package installation, basic syntax)</li>
</ul>
<p><strong>Other Notes</strong>: I built this on OSX, so some language or operations may be OS specific.</p>
<h2 id=setting-up-a-workflow>Setting up a Workflow<a hidden class=anchor aria-hidden=true href=#setting-up-a-workflow>#</a></h2>
<p>Let’s create a simple “Hello World” Flask app to understand the foundational structure of a Flask application. As we do so, we&rsquo;ll walk through the steps of a workflow that will allow us to test our application from within Slack.</p>
<h3 id=creating-a-flask-app>Creating a Flask App<a hidden class=anchor aria-hidden=true href=#creating-a-flask-app>#</a></h3>
<p>Create a new folder for your application and inside of it create a new python file &ndash; <code>hello.py</code> will work. Insert the following code into that file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask
<span style=color:#f92672>import</span> os

app <span style=color:#f92672>=</span> Flask(__name__)

<span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/hello&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hello</span>():
    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;Hello Slack!&#39;</span>

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    port <span style=color:#f92672>=</span> int(os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#ae81ff>5000</span>))
    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span>port, debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</code></pre></div><p>This is actually our entire application. Let&rsquo;s take a look at one block at a time to understand the code.</p>
<h4 id=importing-flask--creating-an-application-object>Importing Flask & Creating an Application Object<a hidden class=anchor aria-hidden=true href=#importing-flask--creating-an-application-object>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask
<span style=color:#f92672>import</span> os

app <span style=color:#f92672>=</span> Flask(__name__)
</code></pre></div><p>In this step we&rsquo;re importing the required libraries. We&rsquo;re importing the <code>Flask</code> class from the <code>flask</code> package, as well as the <code>os</code> package, which we&rsquo;ll need later in our code.</p>
<p>We&rsquo;re also creating an application object named <code>app</code> from the <code>Flask</code> class. Don&rsquo;t worry about the <code>__name__</code> parameter for the Flask object, if you&rsquo;re really curious <a href=http://flask.pocoo.org/docs/0.10/api/>here&rsquo;s some detail</a>.</p>
<h4 id=defining-routing-and-request-methods>Defining Routing and Request Methods<a hidden class=anchor aria-hidden=true href=#defining-routing-and-request-methods>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/hello&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hello</span>():
    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;Hello Slack!&#39;</span>
</code></pre></div><p>This is the functional meat of our application so let&rsquo;s break it down. <code>@app.route()</code> is a function decorator &ndash; it basically modifies something about the next function we&rsquo;re going to declare. The first parameter to this decorator is <code>'/hello'</code>. This parameter is critically important: it defines what happens when someone goes to the URL <code>http://www.oururl.com/hello</code>. The second parameter is <code>methods=['POST']</code>. This is telling us that we are only going to accept POST requests at this route.</p>
<p>The idea of requests were a bit perplexing to me at first so I&rsquo;ll try and briefly explain. At the most basic level, communication on the internet mostly exists between clients and servers (there&rsquo;s actually a good Simple Wikipedia article on <a href=https://simple.wikipedia.org/wiki/Client-server>this</a>). For example: when you&rsquo;re surfing the web, you&rsquo;re actually making a <code>GET</code> request as a client to the server in order to view a webpage. This request tells a website or application to &ldquo;give the client some information&rdquo;. For this current page that information is HTML and some other files that are then interpreted by your web browser and displayed. <code>POST</code> requests tell a site or application that it will be receiving information at that URL. That is: instead of a website or application sending something, the application will receive something. In our case, our application is going to receive the <code>POST</code> request from Slack, and that request will contain some information which our application can use.</p>
<p>Finally we define the <code>hello()</code> function, which defines what happens when someone uses our <code>/hello</code> route. In this case, all we&rsquo;re going to do is return a string to them that says <code>Hello Slack!</code> if a request is made.</p>
<h4 id=declaring-the-application-port>Declaring the Application Port<a hidden class=anchor aria-hidden=true href=#declaring-the-application-port>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    port <span style=color:#f92672>=</span> int(os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#ae81ff>5000</span>))
    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span>port, debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</code></pre></div><p>This last chunk does something simple: when you run this program (and it&rsquo;s the <a href=http://stackoverflow.com/questions/419163/what-does-if-name-main-do>main program</a>), find the port of <code>5000</code>, and then finally serve the application locally using that port.</p>
<h3 id=testing-our-application-with-ngrok>Testing our Application with ngrok<a hidden class=anchor aria-hidden=true href=#testing-our-application-with-ngrok>#</a></h3>
<p>Our application should be ready to test. Open terminal and navigate to your project folder, and type <code>python hello.py</code> to start our program. Terminal should pop up some information about where the server is running and that the debugger is active. Now we have to test our application.</p>
<p>This was a step that actually stumped me for a while. Previously, I had built applications or websites that only accepted <code>GET</code> requests. In this case, we can test it locally by just running the python file we created and browsing to <code>http://localhost:5000/hello</code> and we can see our application. If we did that now with our application, we&rsquo;ll get a nice Method Not Allowed page since our application only accepts post requests.</p>
<p>We could send <code>POST</code> requests from our computer to our application locally using <code>curl</code>, but that&rsquo;s more work than just loading a page in a browser and, more importantly, we would have to put some effort into making sure our request was in the same format as it would come from Slack. Additionally, our request won&rsquo;t be coming from our local computer to our local server, it will be coming from wherever the Slack server is to our server. Because of that, we can&rsquo;t use <code>localhost</code> for testing with Slack, since <code>localhost</code> (relative to Slack, which is sending the request) is where the Slack server is, and it doesn&rsquo;t have our application files.</p>
<p>Luckily, there&rsquo;s a fantastic application called <a href=https://ngrok.com/>ngrok</a> that allows us to create a public URL to access a local server. We can use this to host our application locally, then point our Slack application to the public URL generated by ngrok. Using ngrok is fairly simple: download the file, open a shell to where you downloaded the file (or take this time to add it to your path), and type <code>ngrok http 5000</code> in the shell. You should now see something like this in your terminal:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ngrok by @inconshreveable                                       

Tunnel Status                 online
Version                       2.0.19/2.0.19
Web Interface                 http://127.0.0.1:4040
Forwarding                    http://c654a618.ngrok.io -&gt; localhost:5000
Forwarding                    https://c654a618.ngrok.io -&gt; localhost:5000

Connections                   ttl     opn     rt1     rt5     p50     p90
                            <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>0</span>       0.00    0.00    0.00    0.00
</code></pre></div><p>If we were accepting <code>GET</code> requests in our app, we could now head to the URLs above and view our page. However, if we go there now, nothing will happen since we&rsquo;re only accepting <code>POST</code> requests.</p>
<h3 id=adding-our-slash-command-to-slack>Adding our Slash Command to Slack<a hidden class=anchor aria-hidden=true href=#adding-our-slash-command-to-slack>#</a></h3>
<p>To add a slash command integration to your Slack channel, head to <a href=https://slack.com/apps>https://slack.com/apps</a>, then navigate to <em>Browse apps > Custom Integrations > Slash Commands</em> and click the <em>Add Configuration</em> button.</p>
<p>Our slash command for our example will start as <code>/hello</code>. Type that in and click <em>Add Slash Command Configuration</em>.</p>
<p>After then, we have some options to configure on our app. The <strong>URL</strong> field is critical here. We&rsquo;re going to paste the URL that <code>ngrok</code> gave us, being sure to append <code>/hello</code> at the end. That means our URL should be something similar to: <code>http://c654a618.ngrok.io/hello</code>. The integration settings should match below:</p>
<p><img loading=lazy src=/assets/integrationsettings.png alt="Displaying the Response">
</p>
<h4 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h4>
<p>Now we can save our integration, head to a Slack channel (I prefer DMs with slackbot), and type <code>/hello</code> into the chat. We should see a response of &ldquo;Hello Slack!&rdquo; immediately after.</p>
<blockquote>
<p><img loading=lazy src=/assets/helloslack.png alt="Displaying the Response">
</p>
</blockquote>
<p>You should also notice the requests popping up in the <code>ngrok</code> Terminal window every time you issue the command.</p>
<h3 id=in-summary>In Summary<a hidden class=anchor aria-hidden=true href=#in-summary>#</a></h3>
<p>Using Python, Flask, and ngrok we developed and tested a simple Flask application that responds to the <code>/hello</code> command in Slack.</p>
<p>Some key ideas that took me a while to comprehend:</p>
<ul>
<li>URLs accept multiple kinds of requests: <code>GET</code> and <code>POST</code> are the most common
<ul>
<li><code>GET</code> says: &ldquo;give me some information&rdquo;</li>
<li><code>POST</code> says: &ldquo;I&rsquo;m giving you information&rdquo;</li>
</ul>
</li>
<li>We can&rsquo;t test complex <code>POST</code> requests easily using <code>localhost</code>. Fortunately, we can use <code>ngrok</code> to get a public URL for a server we&rsquo;re running locally and send it <code>POST</code> requests from Slack</li>
</ul>
<h3 id=next-time>Next Time<a hidden class=anchor aria-hidden=true href=#next-time>#</a></h3>
<p>In the next part (<em>Creating Slack Slash Commands with Python and Flask: Part 2: Electric Bugaloo</em>), we&rsquo;ll extend our app to use a weather API that returns some information about expected rainfall. We&rsquo;ll also work to better understand how Slack sends requests to our app and what information is contained in a <code>POST</code> request.</p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.peterbaumgartner.com/>Peter Baumgartner</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>